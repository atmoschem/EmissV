<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Summary • EmissV</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png"><script src="lightswitch.js"></script><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Summary"><meta property="og:image" content="https://atmoschem.github.io/EmissV/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">EmissV</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.665.9.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/atmoschem/EmissV/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="logo.png" class="logo" alt=""><h1>Summary</h1>
      <small class="dont-index">Source: <a href="https://github.com/atmoschem/EmissV/blob/HEAD/paper.md" class="external-link"><code>paper.md</code></a></small>
    </div>


<div id="summary" class="section level1">

<p>Air quality models need input data containing information about atmosphere (such as temperature, wind, humidity), terrestrial data (such as terrain, land use, soil types) and emissions. Therefore, the emission inventories are easily seen as the scapegoat if a mismatch is found between modelled and observed concentrations of air pollutants [@PullesHeslinga2010]. The anthropogenic emissions, especially vehicular emissions, are highly dependent on human activity and constantly changing due to various factors ranging from economic (such as the state of conservation of the fleet, renewal of the fleet and the price of fuel) to legal aspects (such as the vehicle routing).</p>
<p>The EmissV is an R package that estimates vehicular emissions by a top-down approach, the emissions are calculated using the statistical description of the fleet at available level (National, State, City, etc). The following steps show an example of the workflow for calculating vehicular emissions, this emissions are initially temporally and spatially disaggregated, and then distributed spatially and temporally to be used as input in numeric air quality models such WRF-Chem [@Grelletal2005].</p>
<p><strong>I.</strong> Total: emission of pollutants is estimated from the fleet (number, type and year of vehicles), vehicular activity (km/day) and emission factors (g/km) by pollutant for each interest area (cities, states, countries, etc) or alternatively the totals of some inventory can be used.</p>
<p><strong>II.</strong> Spatial distribution: the package has functions to read information from tables, georeferenced images (tiff), shapefiles (sh), openstreetmap data (osm), global inventories in NetCDF format (nc) to calculate point, line and area sources.</p>
<p><strong>III.</strong> Emission calculation: calculates the final emission from all different sources and converts to model units and resolution.</p>
<p><strong>IV.</strong> Temporal distribution: a set of hourly profiles that represents the mean activity (by hour and day of the week) calculated from traffic counts of toll stations located at São Paulo city available for apply in the emissions.</p>
<p>The package has additional functions for creating emissions from individual sources (including plume rise parameterizations) and to estimate the vehicular emissions of volatile organic compounds from exhaust (through the exhaust pipe), liquid (carter and evaporative) and vapor (fuel transfer operations).</p>
<div class="section level2">
<h2 id="functions-and-data">Functions and data<a class="anchor" aria-label="anchor" href="#functions-and-data"></a></h2>
<p>EmissV counts with the folllwing functions:</p>
<table class="table"><thead><tr class="header"><th>Function</th>
<th>Description</th>
</tr></thead><tbody><tr class="odd"><td>areaSource</td>
<td>Distribution of emissions by area</td>
</tr><tr class="even"><td>emission</td>
<td>Emissions in the format for atmospheric models</td>
</tr><tr class="odd"><td>emissionFactors</td>
<td>Tool to set-up vehicle emission factors</td>
</tr><tr class="even"><td>gridInfo</td>
<td>Read grid information from a NetCDF file</td>
</tr><tr class="odd"><td>lineSource</td>
<td>Distribution of emissions by streets</td>
</tr><tr class="even"><td>perfil</td>
<td>Dataset with temporal profile for vehicular emissions</td>
</tr><tr class="odd"><td>plumeRise</td>
<td>Calculate plume rise height</td>
</tr><tr class="even"><td>pointSource</td>
<td>Emissions from point sources</td>
</tr><tr class="odd"><td>rasterSource</td>
<td>Distribution of emissions by a georeferenced image</td>
</tr><tr class="even"><td>read</td>
<td>Read NetCDF data from global inventories</td>
</tr><tr class="odd"><td>streedDist</td>
<td>Distribution by OpenStreetMap street</td>
</tr><tr class="even"><td>totalEmission</td>
<td>Calculate total emissions</td>
</tr><tr class="odd"><td>totalVOC</td>
<td>Calculate total VOCs emissions</td>
</tr><tr class="even"><td>vehicles</td>
<td>Tool to set-up vehicle data frame</td>
</tr></tbody></table></div>
<div class="section level2">
<h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a></h2>
<p>The following example creates an area source for São Paulo State (Brasil). The <code>vehicles</code> function creates a <code>data.frame</code> with information about the São Paulo Fleet using data from [@detran2016], the <code>emissionFactors</code> creates a <code>data.frame</code> with emission factors for CO and PM [@cetesbEV2015]. The <code>totalEmission</code> calculates the total emissions of CO for these vehicles and this emission factors. The next 3 lines opens different data: wrf file, a raster and the area shapefiles. These data are the input for <code>areaSouce</code> that creates an area source based on an image of persistent lights of the Defense Meteorological Satellite Program (DMSP) for São Paulo and Minas Gerais (Brasil) states and finally the function <code>emission</code> calculates the CO emissions.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://atmoschem.github.io/EmissV/">EmissV</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">fleet</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/vehicles.html">vehicles</a></span><span class="op">(</span>example <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="co"># using a example of vehicles (DETRAN 2016 data and SP vahicle distribution):</span></span>
<span><span class="co">#                              Category   Type Fuel      Use       SP ...</span></span>
<span><span class="co"># Light Duty Vehicles Gasohol   LDV_E25    LDV  E25  41 km/d 11624342 ...</span></span>
<span><span class="co"># Light Duty Vehicles Ethanol  LDV_E100    LDV E100  41 km/d   874627 ...</span></span>
<span><span class="co"># Light Duty Vehicles Flex        LDV_F    LDV FLEX  41 km/d  9845022 ...</span></span>
<span><span class="co"># Diesel Trucks               TRUCKS_B5 TRUCKS   B5 110 km/d   710634 ...</span></span>
<span><span class="co"># Diesel Urban Busses           CBUS_B5    BUS   B5 165 km/d   792630 ...</span></span>
<span><span class="co"># Diesel Intercity Busses       MBUS_B5    BUS   B5 165 km/d    21865 ...</span></span>
<span><span class="co"># Gasohol Motorcycles          MOTO_E25   MOTO  E25 140 km/d  3227921 ...</span></span>
<span><span class="co"># Flex Motorcycles               MOTO_F   MOTO FLEX 140 km/d   235056 ...</span></span>
<span></span>
<span><span class="co"># dropping the fleet from Rio de Janeiro (RJ), Parana (PR) and Santa Catarina (SC)</span></span>
<span><span class="va">fleet</span> <span class="op">&lt;-</span> <span class="va">fleet</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">6</span>,<span class="op">-</span><span class="fl">8</span>,<span class="op">-</span><span class="fl">9</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">EF</span>     <span class="op">&lt;-</span> <span class="fu"><a href="reference/emissionFactor.html">emissionFactor</a></span><span class="op">(</span>example <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="co"># using a example emission factor (values calculated from CETESB 2015):</span></span>
<span><span class="co">#                                     CO          PM</span></span>
<span><span class="co"># Light Duty Vehicles Gasohol  1.75 g/km 0.0013 g/km</span></span>
<span><span class="co"># Light Duty Vehicles Ethanol 10.04 g/km 0.0000 g/km</span></span>
<span><span class="co"># Light Duty Vehicles Flex     0.39 g/km 0.0010 g/km</span></span>
<span><span class="co"># Diesel Trucks                0.45 g/km 0.0612 g/km</span></span>
<span><span class="co"># Diesel Urban Busses          0.77 g/km 0.1052 g/km</span></span>
<span><span class="co"># Diesel Intercity Busses      1.48 g/km 0.1693 g/km</span></span>
<span><span class="co"># Gasohol Motorcycles          1.61 g/km 0.0000 g/km</span></span>
<span><span class="co"># Flex Motorcycles             0.75 g/km 0.0000 g/km</span></span>
<span></span>
<span><span class="va">TOTAL</span>  <span class="op">&lt;-</span> <span class="fu"><a href="reference/totalEmission.html">totalEmission</a></span><span class="op">(</span><span class="va">fleet</span>,<span class="va">EF</span>,pol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CO"</span><span class="op">)</span>,verbose <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="co"># Total of CO : 1128297.0993334 t year-1</span></span>
<span></span>
<span><span class="va">grid</span>   <span class="op">&lt;-</span> <span class="fu"><a href="reference/gridInfo.html">gridInfo</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"EmissV"</span><span class="op">)</span>,</span>
<span>                   <span class="st">"/wrfinput_d02"</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Grid information from: .../EmissV/extdata/wrfinput_d02</span></span>
<span></span>
<span><span class="va">raster</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html" class="external-link">raster</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"EmissV"</span><span class="op">)</span>,</span>
<span>                         <span class="st">"/dmsp_hi-res.tiff"</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">shape</span>  <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/shapefile.html" class="external-link">shapefile</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"EmissV"</span><span class="op">)</span>,</span>
<span>                            <span class="st">"/BR.shp"</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>,verbose <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">[</span><span class="fl">12</span>,<span class="fl">1</span><span class="op">]</span></span>
<span>                            </span>
<span><span class="va">Minas_Gerais</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/areaSource.html">areaSource</a></span><span class="op">(</span><span class="va">shape</span>,<span class="va">raster</span>,<span class="va">grid</span>,name <span class="op">=</span> <span class="st">"Minas Gerais"</span><span class="op">)</span></span>
<span><span class="co"># processing Minas Gerais area ...</span></span>
<span><span class="co"># fraction of Minas Gerais area inside the domain = 0.0147607845622591</span></span>
<span></span>
<span><span class="va">shape</span>  <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/shapefile.html" class="external-link">shapefile</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"EmissV"</span><span class="op">)</span>,</span>
<span>                            <span class="st">"/BR.shp"</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>,verbose <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">[</span><span class="fl">22</span>,<span class="fl">1</span><span class="op">]</span></span>
<span>                            </span>
<span><span class="va">Sao_Paulo</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/areaSource.html">areaSource</a></span><span class="op">(</span><span class="va">shape</span>,<span class="va">raster</span>,<span class="va">grid</span>,name <span class="op">=</span> <span class="st">"Sao Paulo"</span><span class="op">)</span></span>
<span><span class="co"># processing Sao Paulo area ...</span></span>
<span><span class="co"># fraction of Sao Paulo area inside the domain = 0.473260323300595</span></span>
<span></span>
<span><span class="fu">sp</span><span class="fu">::</span><span class="fu"><a href="https://edzer.github.io/sp/reference/spplot.html" class="external-link">spplot</a></span><span class="op">(</span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="fu">drop_units</span><span class="op">(</span><span class="va">TOTAL</span><span class="op">$</span><span class="va">CO</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="va">Sao_Paulo</span>, </span>
<span>                         <span class="fu">drop_units</span><span class="op">(</span><span class="va">TOTAL</span><span class="op">$</span><span class="va">CO</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="va">Minas_Gerais</span><span class="op">)</span>,</span>
<span>           scales <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>draw<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>,ylab<span class="op">=</span><span class="st">"Lat"</span>,xlab<span class="op">=</span><span class="st">"Lon"</span>,</span>
<span>           <span class="co"># main=list(label="Emissions of CO [g/d]"),</span></span>
<span>           col.regions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#031638"</span>,<span class="st">"#001E48"</span>,<span class="st">"#002756"</span>,<span class="st">"#003062"</span>,</span>
<span>                           <span class="st">"#003A6E"</span>,<span class="st">"#004579"</span>,<span class="st">"#005084"</span>,<span class="st">"#005C8E"</span>,</span>
<span>                           <span class="st">"#006897"</span>,<span class="st">"#0074A1"</span>,<span class="st">"#0081AA"</span>,<span class="st">"#008FB3"</span>,</span>
<span>                           <span class="st">"#009EBD"</span>,<span class="st">"#00AFC8"</span>,<span class="st">"#00C2D6"</span>,<span class="st">"#00E3F0"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">CO_emissions</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/emission.html">emission</a></span><span class="op">(</span>total <span class="op">=</span> <span class="va">TOTAL</span>,</span>
<span>                         pol   <span class="op">=</span> <span class="st">"CO"</span>,</span>
<span>                         area  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>SP <span class="op">=</span> <span class="va">Sao_Paulo</span>, MG <span class="op">=</span> <span class="va">Minas_Gerais</span><span class="op">)</span>,</span>
<span>                         grid  <span class="op">=</span> <span class="va">grid</span>,</span>
<span>                         mm    <span class="op">=</span> <span class="fl">28</span>, </span>
<span>                         plot  <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="co"># calculating emissions for CO using molar mass = 28 ...</span></span></code></pre></div>
<div class="float">
<img src="https://raw.githubusercontent.com/atmoschem/EmissV/master/CO_all.png" alt="Emissions of CO using nocturnal lights."><div class="figcaption">Emissions of CO using nocturnal lights.</div>
</div>
<div class="float">
<img src="https://raw.githubusercontent.com/atmoschem/EmissV/master/CO_final.png" alt="CO emissions ready for use in air quality model."><div class="figcaption">CO emissions ready for use in air quality model.</div>
</div>
<p>The emissions of CO calculated in this example can be seen in Figure 1 in <code>g/d</code> (by pixel) and the final emissions on Figure 2 in <code>MOL h-1 km-1</code> (by model grid cell). This emissions can be written to WRF-Chem emission files using some package that makes the interface with NetCDF format such as <strong>ncdf4</strong> [@ncdf4], <strong>RNetCDF</strong> [@RNetCDF], <strong>ncdf.tools</strong> [@ncdftools] or with the <strong>eixport</strong> [@eixport]. Some output values (also figures generated by EmissV) might differ slightly depending on the EmissV package-version (as well as different versios of ncdf4, units, raster, sf, lwgeom, etc) and changes to the sample files.</p>
<p>The R package EmissV is available at the repository <a href="https://github.com/atmoschem/EmissV" class="external-link uri">https://github.com/atmoschem/EmissV</a>. And this installation is tested automatically on Linux via <a href="https://travis-ci.org/atmoschem/EmissV" class="external-link">TravisCI</a> and Windows via <a href="https://ci.appveyor.com/project/Schuch666/EmissC" class="external-link">Appveyor</a> continuous integration systems. Also, EmissV is already on CRAN <a href="https://CRAN.R-project.org/package=EmissV" class="external-link uri">https://CRAN.R-project.org/package=EmissV</a>.</p>
</div>
</div>
<div class="section level1">
<h1 id="acknowledgements">Acknowledgements<a class="anchor" aria-label="anchor" href="#acknowledgements"></a></h1>
<p>The development of EmissV was supported by postdoc grans from the Fundação da Universidade de São Paulo and Fundação Coordenação de Aperfeiçoamento de Pessoal de Nível Superior.</p>
</div>
<div class="section level1">
<h1 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h1>
</div>


  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Daniel Schuch, Sergio Ibarra-Espinosa.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

